exports.ids=[2],exports.modules={244:function(e,t,s){"use strict";s.r(t),s.d(t,"AlchemyWebSocketProvider",(function(){return w}));var i=s(6),n=s(261),o=s.n(n),r=s(4),a=s(254),c=s(1),h=s(282),l=s(2),u=s(251);let d=null;try{if(d=WebSocket,null==d)throw new Error("inject please")}catch(e){const t=new l.a(u.a);d=function(){t.throwError("WebSockets not supported in this environment",l.a.errors.UNSUPPORTED_OPERATION,{operation:"new WebSocket()"})}}var f=function(e,t,s,i){return new(s||(s=Promise))((function(n,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}c((i=i.apply(e,t||[])).next())}))};const p=new l.a(u.a);let m=1;class b extends h.a{constructor(e,t){"any"===t&&p.throwError("WebSocketProvider does not support 'any' network yet",l.a.errors.UNSUPPORTED_OPERATION,{operation:"network:any"}),super("string"==typeof e?e:"_websocket",t),this._pollingInterval=-1,this._wsReady=!1,"string"==typeof e?Object(c.d)(this,"_websocket",new d(this.connection.url)):Object(c.d)(this,"_websocket",e),Object(c.d)(this,"_requests",{}),Object(c.d)(this,"_subs",{}),Object(c.d)(this,"_subIds",{}),Object(c.d)(this,"_detectNetwork",super.detectNetwork()),this.websocket.onopen=()=>{this._wsReady=!0,Object.keys(this._requests).forEach(e=>{this.websocket.send(this._requests[e].payload)})},this.websocket.onmessage=e=>{const t=e.data,s=JSON.parse(t);if(null!=s.id){const e=String(s.id),i=this._requests[e];if(delete this._requests[e],void 0!==s.result)i.callback(null,s.result),this.emit("debug",{action:"response",request:JSON.parse(i.payload),response:s.result,provider:this});else{let e=null;s.error?(e=new Error(s.error.message||"unknown error"),Object(c.d)(e,"code",s.error.code||null),Object(c.d)(e,"response",t)):e=new Error("unknown error"),i.callback(e,void 0),this.emit("debug",{action:"response",error:e,request:JSON.parse(i.payload),provider:this})}}else if("eth_subscription"===s.method){const e=this._subs[s.params.subscription];e&&e.processFunc(s.params.result)}else console.warn("this should not happen")};const s=setInterval(()=>{this.emit("poll")},1e3);s.unref&&s.unref()}get websocket(){return this._websocket}detectNetwork(){return this._detectNetwork}get pollingInterval(){return 0}resetEventsBlock(e){p.throwError("cannot reset events block on WebSocketProvider",l.a.errors.UNSUPPORTED_OPERATION,{operation:"resetEventBlock"})}set pollingInterval(e){p.throwError("cannot set polling interval on WebSocketProvider",l.a.errors.UNSUPPORTED_OPERATION,{operation:"setPollingInterval"})}poll(){return f(this,void 0,void 0,(function*(){return null}))}set polling(e){e&&p.throwError("cannot set polling on WebSocketProvider",l.a.errors.UNSUPPORTED_OPERATION,{operation:"setPolling"})}send(e,t){const s=m++;return new Promise((i,n)=>{const o=JSON.stringify({method:e,params:t,id:s,jsonrpc:"2.0"});this.emit("debug",{action:"request",request:JSON.parse(o),provider:this}),this._requests[String(s)]={callback:function(e,t){return e?n(e):i(t)},payload:o},this._wsReady&&this.websocket.send(o)})}static defaultUrl(){return"ws://localhost:8546"}_subscribe(e,t,s){return f(this,void 0,void 0,(function*(){let i=this._subIds[e];null==i&&(i=Promise.all(t).then(e=>this.send("eth_subscribe",e)),this._subIds[e]=i);const n=yield i;this._subs[n]={tag:e,processFunc:s}}))}_startEvent(e){switch(e.type){case"block":this._subscribe("block",["newHeads"],e=>{const t=r.a.from(e.number).toNumber();this._emitted.block=t,this.emit("block",t)});break;case"pending":this._subscribe("pending",["newPendingTransactions"],e=>{this.emit("pending",e)});break;case"filter":this._subscribe(e.tag,["logs",this._getFilter(e.filter)],t=>{null==t.removed&&(t.removed=!1),this.emit(e.filter,this.formatter.filterLog(t))});break;case"tx":{const t=e=>{const t=e.hash;this.getTransactionReceipt(t).then(e=>{e&&this.emit(t,e)})};t(e),this._subscribe("tx",["newHeads"],e=>{this._events.filter(e=>"tx"===e.type).forEach(t)});break}case"debug":case"poll":case"willPoll":case"didPoll":case"error":break;default:console.log("unhandled:",e)}}_stopEvent(e){let t=e.tag;if("tx"===e.type){if(this._events.filter(e=>"tx"===e.type).length)return;t="tx"}else if(this.listenerCount(e.event))return;const s=this._subIds[t];s&&(delete this._subIds[t],s.then(e=>{this._subs[e]&&(delete this._subs[e],this.send("eth_unsubscribe",[e]))}))}destroy(){return f(this,void 0,void 0,(function*(){this.websocket.readyState===d.CONNECTING&&(yield new Promise(e=>{this.websocket.onopen=function(){e(!0)},this.websocket.onerror=function(){e(!1)}})),this.websocket.close(1e3)}))}}var g=s(242);s(49);class v{constructor(e){this.provider=e,this.maxBackfillBlocks=120}getNewHeadsBackfill(e,t,s){return Object(i.z)(this,void 0,void 0,(function*(){E(e);const n=yield this.getBlockNumber();if(E(e),0===t.length)return this.getHeadEventsInRange(Math.max(s,n-this.maxBackfillBlocks)+1,n+1);const o=Object(i.F)(t[t.length-1].number),r=n-this.maxBackfillBlocks+1;if(o<=r)return this.getHeadEventsInRange(r,n+1);const a=yield this.getReorgHeads(e,t);E(e);const c=yield this.getHeadEventsInRange(o+1,n+1);return E(e),[...a,...c]}))}getLogsBackfill(e,t,s,n){return Object(i.z)(this,void 0,void 0,(function*(){E(e);const o=yield this.getBlockNumber();if(E(e),0===s.length)return this.getLogsInRange(t,Math.max(n,o-this.maxBackfillBlocks)+1,o+1);const r=Object(i.F)(s[s.length-1].blockNumber),a=o-this.maxBackfillBlocks+1;if(r<a)return this.getLogsInRange(t,a,o+1);const c=yield this.getCommonAncestor(e,s);E(e);const h=s.filter(e=>Object(i.F)(e.blockNumber)>c.blockNumber).map(e=>Object.assign(Object.assign({},e),{removed:!0})),l=c.blockNumber===Number.NEGATIVE_INFINITY?Object(i.F)(s[0].blockNumber):c.blockNumber;let u=yield this.getLogsInRange(t,l,o+1);return u=u.filter(e=>e&&(Object(i.F)(e.blockNumber)>c.blockNumber||Object(i.F)(e.logIndex)>c.logIndex)),E(e),[...h,...u]}))}setMaxBackfillBlock(e){this.maxBackfillBlocks=e}getBlockNumber(){return Object(i.z)(this,void 0,void 0,(function*(){const e=yield this.provider.send("eth_blockNumber");return Object(i.F)(e)}))}getHeadEventsInRange(e,t){return Object(i.z)(this,void 0,void 0,(function*(){if(e>=t)return[];const s=[];for(let n=e;n<t;n++)s.push({method:"eth_getBlockByNumber",params:[Object(i.T)(n),!1]});return(yield this.provider.sendBatch(s)).map(y)}))}getReorgHeads(e,t){return Object(i.z)(this,void 0,void 0,(function*(){const s=[];for(let n=t.length-1;n>=0;n--){const o=t[n],r=yield this.getBlockByNumber(Object(i.F)(o.number));if(E(e),o.hash===r.hash)break;s.push(y(r))}return s.reverse()}))}getBlockByNumber(e){return Object(i.z)(this,void 0,void 0,(function*(){return this.provider.send("eth_getBlockByNumber",[Object(i.T)(e),!1])}))}getCommonAncestor(e,t){return Object(i.z)(this,void 0,void 0,(function*(){let s=yield this.getBlockByNumber(Object(i.F)(t[t.length-1].blockNumber));E(e);for(let e=t.length-1;e>=0;e--){const n=t[e];if(n.blockNumber!==s.number&&(s=yield this.getBlockByNumber(Object(i.F)(n.blockNumber))),n.blockHash===s.hash)return{blockNumber:Object(i.F)(n.blockNumber),logIndex:Object(i.F)(n.logIndex)}}return{blockNumber:Number.NEGATIVE_INFINITY,logIndex:Number.NEGATIVE_INFINITY}}))}getLogsInRange(e,t,s){return Object(i.z)(this,void 0,void 0,(function*(){if(t>=s)return[];const n=Object.assign(Object.assign({},e),{fromBlock:Object(i.T)(t),toBlock:Object(i.T)(s-1)});return this.provider.send("eth_getLogs",[n])}))}}function y(e){const t=Object.assign({},e);return delete t.totalDifficulty,delete t.transactions,delete t.uncles,t}function k(e,t){const s=new Set,i=[];return e.forEach(e=>{const n=t(e);s.has(n)||(s.add(n),i.push(e))}),i}const _=new Error("Cancelled");function E(e){if(e())throw _}class w extends b{constructor(e,t){var n;const r=g.AlchemyProvider.getApiKey(e.apiKey),a=g.AlchemyProvider.getAlchemyNetwork(e.network),c=g.AlchemyProvider.getAlchemyConnectionInfo(a,r,"wss"),h="alchemy-sdk-"+i.v;super(new o.a(null!==(n=e.url)&&void 0!==n?n:c.url,h,{wsConstructor:null!=t?t:"undefined"!=typeof process&&null!=process&&null!=process.versions&&null!=process.versions.node?s(262).w3cwebsocket:WebSocket}),i.e[a]),this._events=[],this.virtualSubscriptionsById=new Map,this.virtualIdsByPhysicalId=new Map,this.handleMessage=e=>{const t=JSON.parse(e.data);if(!function(e){return!function(e){return Array.isArray(e)||"2.0"===e.jsonrpc&&void 0!==e.id}(e)}(t))return;const s=t.params.subscription,i=this.virtualIdsByPhysicalId.get(s);if(!i)return;const n=this.virtualSubscriptionsById.get(i);if("eth_subscribe"===n.method)switch(n.params[0]){case"newHeads":{const e=n,o=t,{isBackfilling:r,backfillBuffer:a}=e,{result:c}=o.params;r?function(e,t){A(e,t,R)}(a,c):s!==i?this.emitAndRememberEvent(i,c,R):this.rememberEvent(i,c,R);break}case"logs":{const e=n,o=t,{isBackfilling:r,backfillBuffer:a}=e,{result:c}=o.params;r?function(e,t){A(e,t,T)}(a,c):i!==s?this.emitAndRememberEvent(i,c,T):this.rememberEvent(i,c,T);break}default:if(s!==i){const{result:e}=t.params;this.emitEvent(i,e)}}},this.handleReopen=()=>{this.virtualIdsByPhysicalId.clear();const{cancel:e,isCancelled:t}=function(){let e=!1;return{cancel:()=>e=!0,isCancelled:()=>e}}();this.cancelBackfill=e;for(const e of this.virtualSubscriptionsById.values())(()=>{Object(i.z)(this,void 0,void 0,(function*(){try{yield this.resubscribeAndBackfill(t,e)}catch(s){t()||console.error(`Error while backfilling "${e.params[0]}" subscription. Some events may be missing.`,s)}}))})();this.startHeartbeat()},this.stopHeartbeatAndBackfill=()=>{null!=this.heartbeatIntervalId&&(clearInterval(this.heartbeatIntervalId),this.heartbeatIntervalId=void 0),this.cancelBackfill()},this.apiKey=r,this.backfiller=new v(this),this.addSocketListeners(),this.startHeartbeat(),this.cancelBackfill=i.N}static getNetwork(e){return"string"==typeof e&&e in i.c?i.c[e]:Object(a.a)(e)}on(e,t){return this._addEventListener(e,t,!1)}once(e,t){return this._addEventListener(e,t,!0)}off(e,t){return Object(i.I)(e)?this._off(e,t):super.off(e,t)}removeAllListeners(e){return void 0!==e&&Object(i.I)(e)?this._removeAllListeners(e):super.removeAllListeners(e)}listenerCount(e){return void 0!==e&&Object(i.I)(e)?this._listenerCount(e):super.listenerCount(e)}listeners(e){return void 0!==e&&Object(i.I)(e)?this._listeners(e):super.listeners(e)}_addEventListener(e,t,s){if(Object(i.I)(e)){Object(i.V)(e);const n=new i.C(Object(i.E)(e),t,s);return this._events.push(n),this._startEvent(n),this}return super._addEventListener(e,t,s)}_startEvent(e){[...i.a,"block","filter"].includes(e.type)?this.customStartEvent(e):super._startEvent(e)}_subscribe(e,t,s,n){return Object(i.z)(this,void 0,void 0,(function*(){let i=this._subIds[e];const o=yield this.getBlockNumber();null==i&&(i=Promise.all(t).then(e=>this.send("eth_subscribe",e)),this._subIds[e]=i);const r=yield i,a=yield Promise.all(t);this.virtualSubscriptionsById.set(r,{event:n,method:"eth_subscribe",params:a,startingBlockNumber:o,virtualId:r,physicalId:r,sentEvents:[],isBackfilling:!1,backfillBuffer:[]}),this.virtualIdsByPhysicalId.set(r,r),this._subs[r]={tag:e,processFunc:s}}))}emit(e,...t){if(Object(i.I)(e)){let s=!1;const n=[],o=Object(i.E)(e);return this._events=this._events.filter(e=>e.tag!==o||(setTimeout(()=>{e.listener.apply(this,t)},0),s=!0,!e.once||(n.push(e),!1))),n.forEach(e=>{this._stopEvent(e)}),s}return super.emit(e,...t)}sendBatch(e){return Object(i.z)(this,void 0,void 0,(function*(){let t=0;const s=e.map(({method:e,params:s})=>({method:e,params:s,jsonrpc:"2.0",id:"alchemy-sdk:"+t++}));return this.sendBatchConcurrently(s)}))}destroy(){return this.removeSocketListeners(),this.stopHeartbeatAndBackfill(),super.destroy()}isCommunityResource(){return this.apiKey===i.d}_stopEvent(e){let t=e.tag;if(i.a.includes(e.type)){if(this._events.filter(e=>i.a.includes(e.type)).length)return}else if("tx"===e.type){if(this._events.filter(e=>"tx"===e.type).length)return;t="tx"}else if(this.listenerCount(e.event))return;const s=this._subIds[t];s&&(delete this._subIds[t],s.then(e=>{this._subs[e]&&(delete this._subs[e],this.send("eth_unsubscribe",[e]))}))}addSocketListeners(){this._websocket.addEventListener("message",this.handleMessage),this._websocket.addEventListener("reopen",this.handleReopen),this._websocket.addEventListener("down",this.stopHeartbeatAndBackfill)}removeSocketListeners(){this._websocket.removeEventListener("message",this.handleMessage),this._websocket.removeEventListener("reopen",this.handleReopen),this._websocket.removeEventListener("down",this.stopHeartbeatAndBackfill)}resubscribeAndBackfill(e,t){return Object(i.z)(this,void 0,void 0,(function*(){const{virtualId:s,method:i,params:n,sentEvents:o,backfillBuffer:r,startingBlockNumber:a}=t;t.isBackfilling=!0,r.length=0;try{const c=yield this.send(i,n);switch(E(e),t.physicalId=c,this.virtualIdsByPhysicalId.set(c,s),n[0]){case"newHeads":{const t=yield S(()=>C(this.backfiller.getNewHeadsBackfill(e,o,a),6e4),5,()=>!e());E(e);(function(e){return k(e,e=>e.hash)})([...t,...r]).forEach(e=>this.emitNewHeadsEvent(s,e));break}case"logs":{const t=n[1]||{},i=yield S(()=>C(this.backfiller.getLogsBackfill(e,t,o,a),6e4),5,()=>!e());E(e);(function(e){return k(e,e=>`${e.blockHash}/${e.logIndex}`)})([...i,...r]).forEach(e=>this.emitLogsEvent(s,e));break}}}finally{t.isBackfilling=!1,r.length=0}}))}emitNewHeadsEvent(e,t){this.emitAndRememberEvent(e,t,R)}emitLogsEvent(e,t){this.emitAndRememberEvent(e,t,T)}emitAndRememberEvent(e,t,s){this.rememberEvent(e,t,s),this.emitEvent(e,t)}emitEvent(e,t){const s=this.virtualSubscriptionsById.get(e);s&&this.emitGenericEvent(s,t)}rememberEvent(e,t,s){const i=this.virtualSubscriptionsById.get(e);i&&A(i.sentEvents,Object.assign({},t),s)}emitGenericEvent(e,t){this.emitProcessFn(e.event)(t)}startHeartbeat(){null==this.heartbeatIntervalId&&(this.heartbeatIntervalId=setInterval(()=>Object(i.z)(this,void 0,void 0,(function*(){try{yield C(this.send("net_version"),1e4)}catch(e){this._websocket.reconnect()}})),3e4))}sendBatchConcurrently(e){return Object(i.z)(this,void 0,void 0,(function*(){return Promise.all(e.map(e=>this.send(e.method,e.params)))}))}customStartEvent(e){if(e.type===i.H){const{fromAddress:t,toAddress:s,hashesOnly:n}=e;this._subscribe(e.tag,[i.J.PENDING_TRANSACTIONS,{fromAddress:t,toAddress:s,hashesOnly:n}],this.emitProcessFn(e),e)}else if(e.type===i.K){const{addresses:t,includeRemoved:s,hashesOnly:n}=e;this._subscribe(e.tag,[i.J.MINED_TRANSACTIONS,{addresses:t,includeRemoved:s,hashesOnly:n}],this.emitProcessFn(e),e)}else"block"===e.type?this._subscribe("block",["newHeads"],this.emitProcessFn(e),e):"filter"===e.type&&this._subscribe(e.tag,["logs",this._getFilter(e.filter)],this.emitProcessFn(e),e)}emitProcessFn(e){switch(e.type){case i.H:return t=>this.emit({method:i.J.PENDING_TRANSACTIONS,fromAddress:e.fromAddress,toAddress:e.toAddress,hashesOnly:e.hashesOnly},t);case i.K:return t=>this.emit({method:i.J.MINED_TRANSACTIONS,addresses:e.addresses,includeRemoved:e.includeRemoved,hashesOnly:e.hashesOnly},t);case"block":return e=>{const t=r.a.from(e.number).toNumber();this._emitted.block=t,this.emit("block",t)};case"filter":return t=>{null==t.removed&&(t.removed=!1),this.emit(e.filter,this.formatter.filterLog(t))};default:throw new Error("Invalid event type to `emitProcessFn()`")}}_off(e,t){if(null==t)return this.removeAllListeners(e);const s=[];let n=!1;const o=Object(i.E)(e);return this._events=this._events.filter(e=>e.tag!==o||e.listener!=t||(!!n||(n=!0,s.push(e),!1))),s.forEach(e=>{this._stopEvent(e)}),this}_removeAllListeners(e){let t=[];if(null==e)t=this._events,this._events=[];else{const s=Object(i.E)(e);this._events=this._events.filter(e=>e.tag!==s||(t.push(e),!1))}return t.forEach(e=>{this._stopEvent(e)}),this}_listenerCount(e){if(!e)return this._events.length;const t=Object(i.E)(e);return this._events.filter(e=>e.tag===t).length}_listeners(e){if(null==e)return this._events.map(e=>e.listener);const t=Object(i.E)(e);return this._events.filter(e=>e.tag===t).map(e=>e.listener)}}function S(e,t,s=(()=>!0)){return Object(i.z)(this,void 0,void 0,(function*(){let i=0,n=0;for(;;)try{return yield e()}catch(e){if(n++,n>=t||!s(e))throw e;if(yield O(i),!s(e))throw e;i=0===i?1e3:Math.min(3e4,2*i)}}))}function O(e){return new Promise(t=>setTimeout(t,e))}function C(e,t){return Promise.race([e,new Promise((e,s)=>setTimeout(()=>s(new Error("Timeout")),t))])}function R(e){return Object(i.F)(e.number)}function T(e){return Object(i.F)(e.blockNumber)}function A(e,t,s){const i=s(t),n=e.findIndex(e=>s(e)>i-10);-1===n?e.length=0:e.splice(0,n),e.push(t)}},250:function(e,t,s){var i=t.noop=function(){};function n(e,t,s){this.logFunction=s,this.identifier=e,this.uniqueID=t,this.buffer=[]}t.extend=function(e,t){for(var s in t)e[s]=t[s]},t.eventEmitterListenerCount=s(78).EventEmitter.listenerCount||function(e,t){return e.listeners(t).length},t.bufferAllocUnsafe=Buffer.allocUnsafe?Buffer.allocUnsafe:function(e){return new Buffer(e)},t.bufferFromString=Buffer.from?Buffer.from:function(e,t){return new Buffer(e,t)},t.BufferingLogger=function(e,t){var o=s(13)(e);if(o.enabled){var r=new n(e,t,o),a=r.log.bind(r);return a.printOutput=r.printOutput.bind(r),a.enabled=o.enabled,a}return o.printOutput=i,o},n.prototype.log=function(){return this.buffer.push([new Date,Array.prototype.slice.call(arguments)]),this},n.prototype.clear=function(){return this.buffer=[],this},n.prototype.printOutput=function(e){e||(e=this.logFunction);var t=this.uniqueID;this.buffer.forEach((function(s){var i=s[0].toLocaleString(),n=s[1].slice(),o=n[0];null!=o&&(o="%s - %s - "+o.toString(),n.splice(0,1,o,i,t),e.apply(global,n))}))}},253:function(e,t,s){var i=s(39),n=s(250),o=s(78).EventEmitter,r=s(256),a=s(268),c=s(269),h=n.bufferAllocUnsafe,l=n.bufferFromString;var u="setImmediate"in global?global.setImmediate.bind(global):process.nextTick.bind(process),d=0;function f(e,t,s,i,c){if(this._debug=n.BufferingLogger("websocket:connection",++d),this._debug("constructor"),this._debug.enabled&&function(e,t){if(!e._debug.enabled)return;var s=t.emit;for(var i in t.emit=function(t){e._debug("||| Socket Event  '%s'",t),s.apply(this,arguments)},t)"function"==typeof t[i]&&-1===["emit"].indexOf(i)&&function(s){var i=t[s];t[s]="on"!==s?function(){return e._debug("||| Socket method called:  %s",s),i.apply(this,arguments)}:function(){return e._debug("||| Socket method called:  %s (%s)",s,arguments[0]),i.apply(this,arguments)}}(i)}(this,e),o.call(this),this._pingListenerCount=0,this.on("newListener",(function(e){"ping"===e&&this._pingListenerCount++})).on("removeListener",(function(e){"ping"===e&&this._pingListenerCount--})),this.config=c,this.socket=e,this.protocol=s,this.extensions=t,this.remoteAddress=e.remoteAddress,this.closeReasonCode=-1,this.closeDescription=null,this.closeEventEmitted=!1,this.maskOutgoingPackets=i,this.maskBytes=h(4),this.frameHeader=h(10),this.bufferList=new a,this.currentFrame=new r(this.maskBytes,this.frameHeader,this.config),this.fragmentationSize=0,this.frameQueue=[],this.connected=!0,this.state="open",this.waitingForCloseResponse=!1,this.receivedEnd=!1,this.closeTimeout=this.config.closeTimeout,this.assembleFragments=this.config.assembleFragments,this.maxReceivedMessageSize=this.config.maxReceivedMessageSize,this.outputBufferFull=!1,this.inputPaused=!1,this.receivedDataHandler=this.processReceivedData.bind(this),this._closeTimerHandler=this.handleCloseTimer.bind(this),this.socket.setNoDelay(this.config.disableNagleAlgorithm),this.socket.setTimeout(0),this.config.keepalive&&!this.config.useNativeKeepalive){if("number"!=typeof this.config.keepaliveInterval)throw new Error("keepaliveInterval must be specified and numeric if keepalive is true.");if(this._keepaliveTimerHandler=this.handleKeepaliveTimer.bind(this),this.setKeepaliveTimer(),this.config.dropConnectionOnKeepaliveTimeout){if("number"!=typeof this.config.keepaliveGracePeriod)throw new Error("keepaliveGracePeriod  must be specified and numeric if dropConnectionOnKeepaliveTimeout is true.");this._gracePeriodTimerHandler=this.handleGracePeriodTimer.bind(this)}}else if(this.config.keepalive&&this.config.useNativeKeepalive){if(!("setKeepAlive"in this.socket))throw new Error("Unable to use native keepalive: unsupported by this version of Node.");this.socket.setKeepAlive(!0,this.config.keepaliveInterval)}this.socket.removeAllListeners("error")}function p(e){return!(e<1e3)&&(e>=1e3&&e<=2999?-1!==[1e3,1001,1002,1003,1007,1008,1009,1010,1011,1012,1013,1014,1015].indexOf(e):e>=3e3&&e<=3999||(e>=4e3&&e<=4999||!(e>=5e3)&&void 0))}f.CLOSE_REASON_NORMAL=1e3,f.CLOSE_REASON_GOING_AWAY=1001,f.CLOSE_REASON_PROTOCOL_ERROR=1002,f.CLOSE_REASON_UNPROCESSABLE_INPUT=1003,f.CLOSE_REASON_RESERVED=1004,f.CLOSE_REASON_NOT_PROVIDED=1005,f.CLOSE_REASON_ABNORMAL=1006,f.CLOSE_REASON_INVALID_DATA=1007,f.CLOSE_REASON_POLICY_VIOLATION=1008,f.CLOSE_REASON_MESSAGE_TOO_BIG=1009,f.CLOSE_REASON_EXTENSION_REQUIRED=1010,f.CLOSE_REASON_INTERNAL_SERVER_ERROR=1011,f.CLOSE_REASON_TLS_HANDSHAKE_FAILED=1015,f.CLOSE_DESCRIPTIONS={1e3:"Normal connection closure",1001:"Remote peer is going away",1002:"Protocol error",1003:"Unprocessable input",1004:"Reserved",1005:"Reason not provided",1006:"Abnormal closure, no further detail available",1007:"Invalid data received",1008:"Policy violation",1009:"Message too big",1010:"Extension requested by client is required",1011:"Internal Server Error",1015:"TLS Handshake Failed"},i.inherits(f,o),f.prototype._addSocketEventListeners=function(){this.socket.on("error",this.handleSocketError.bind(this)),this.socket.on("end",this.handleSocketEnd.bind(this)),this.socket.on("close",this.handleSocketClose.bind(this)),this.socket.on("drain",this.handleSocketDrain.bind(this)),this.socket.on("pause",this.handleSocketPause.bind(this)),this.socket.on("resume",this.handleSocketResume.bind(this)),this.socket.on("data",this.handleSocketData.bind(this))},f.prototype.setKeepaliveTimer=function(){this._debug("setKeepaliveTimer"),this.config.keepalive&&!this.config.useNativeKeepalive&&(this.clearKeepaliveTimer(),this.clearGracePeriodTimer(),this._keepaliveTimeoutID=setTimeout(this._keepaliveTimerHandler,this.config.keepaliveInterval))},f.prototype.clearKeepaliveTimer=function(){this._keepaliveTimeoutID&&clearTimeout(this._keepaliveTimeoutID)},f.prototype.handleKeepaliveTimer=function(){this._debug("handleKeepaliveTimer"),this._keepaliveTimeoutID=null,this.ping(),this.config.dropConnectionOnKeepaliveTimeout?this.setGracePeriodTimer():this.setKeepaliveTimer()},f.prototype.setGracePeriodTimer=function(){this._debug("setGracePeriodTimer"),this.clearGracePeriodTimer(),this._gracePeriodTimeoutID=setTimeout(this._gracePeriodTimerHandler,this.config.keepaliveGracePeriod)},f.prototype.clearGracePeriodTimer=function(){this._gracePeriodTimeoutID&&clearTimeout(this._gracePeriodTimeoutID)},f.prototype.handleGracePeriodTimer=function(){this._debug("handleGracePeriodTimer"),this._gracePeriodTimeoutID=null,this.drop(f.CLOSE_REASON_ABNORMAL,"Peer not responding.",!0)},f.prototype.handleSocketData=function(e){this._debug("handleSocketData"),this.setKeepaliveTimer(),this.bufferList.write(e),this.processReceivedData()},f.prototype.processReceivedData=function(){if(this._debug("processReceivedData"),this.connected&&!this.inputPaused){var e=this.currentFrame;if(e.addData(this.bufferList)){var t=this;if(e.protocolError)return this._debug("-- protocol error"),void process.nextTick((function(){t.drop(f.CLOSE_REASON_PROTOCOL_ERROR,e.dropReason)}));if(e.frameTooLarge)return this._debug("-- frame too large"),void process.nextTick((function(){t.drop(f.CLOSE_REASON_MESSAGE_TOO_BIG,e.dropReason)}));if(e.rsv1||e.rsv2||e.rsv3)return this._debug("-- illegal rsv flag"),void process.nextTick((function(){t.drop(f.CLOSE_REASON_PROTOCOL_ERROR,"Unsupported usage of rsv bits without negotiated extension.")}));this.assembleFragments||(this._debug("-- emitting frame"),process.nextTick((function(){t.emit("frame",e)}))),process.nextTick((function(){t.processFrame(e)})),this.currentFrame=new r(this.maskBytes,this.frameHeader,this.config),this.bufferList.length>0&&u(this.receivedDataHandler)}else this._debug("-- insufficient data for frame")}},f.prototype.handleSocketError=function(e){this._debug("handleSocketError: %j",e),"closed"!==this.state?(this.closeReasonCode=f.CLOSE_REASON_ABNORMAL,this.closeDescription="Socket Error: "+e.syscall+" "+e.code,this.connected=!1,this.state="closed",this.fragmentationSize=0,n.eventEmitterListenerCount(this,"error")>0&&this.emit("error",e),this.socket.destroy(),this._debug.printOutput()):this._debug("  --- Socket 'error' after 'close'")},f.prototype.handleSocketEnd=function(){this._debug("handleSocketEnd: received socket end.  state = %s",this.state),this.receivedEnd=!0,"closed"!==this.state?"peer_requested_close"!==this.state&&"ending"!==this.state&&(this._debug("  --- UNEXPECTED socket end."),this.socket.end()):this._debug("  --- Socket 'end' after 'close'")},f.prototype.handleSocketClose=function(e){this._debug("handleSocketClose: received socket close"),this.socketHadError=e,this.connected=!1,this.state="closed",-1===this.closeReasonCode&&(this.closeReasonCode=f.CLOSE_REASON_ABNORMAL,this.closeDescription="Connection dropped by remote peer."),this.clearCloseTimer(),this.clearKeepaliveTimer(),this.clearGracePeriodTimer(),this.closeEventEmitted||(this.closeEventEmitted=!0,this._debug("-- Emitting WebSocketConnection close event"),this.emit("close",this.closeReasonCode,this.closeDescription))},f.prototype.handleSocketDrain=function(){this._debug("handleSocketDrain: socket drain event"),this.outputBufferFull=!1,this.emit("drain")},f.prototype.handleSocketPause=function(){this._debug("handleSocketPause: socket pause event"),this.inputPaused=!0,this.emit("pause")},f.prototype.handleSocketResume=function(){this._debug("handleSocketResume: socket resume event"),this.inputPaused=!1,this.emit("resume"),this.processReceivedData()},f.prototype.pause=function(){this._debug("pause: pause requested"),this.socket.pause()},f.prototype.resume=function(){this._debug("resume: resume requested"),this.socket.resume()},f.prototype.close=function(e,t){if(this.connected){if(this._debug("close: Initating clean WebSocket close sequence."),"number"!=typeof e&&(e=f.CLOSE_REASON_NORMAL),!p(e))throw new Error("Close code "+e+" is not valid.");"string"!=typeof t&&(t=f.CLOSE_DESCRIPTIONS[e]),this.closeReasonCode=e,this.closeDescription=t,this.setCloseTimer(),this.sendCloseFrame(this.closeReasonCode,this.closeDescription),this.state="ending",this.connected=!1}},f.prototype.drop=function(e,t,s){this._debug("drop"),"number"!=typeof e&&(e=f.CLOSE_REASON_PROTOCOL_ERROR),"string"!=typeof t&&(t=f.CLOSE_DESCRIPTIONS[e]),this._debug("Forcefully dropping connection. skipCloseFrame: %s, code: %d, description: %s",s,e,t),this.closeReasonCode=e,this.closeDescription=t,this.frameQueue=[],this.fragmentationSize=0,s||this.sendCloseFrame(e,t),this.connected=!1,this.state="closed",this.clearCloseTimer(),this.clearKeepaliveTimer(),this.clearGracePeriodTimer(),this.closeEventEmitted||(this.closeEventEmitted=!0,this._debug("Emitting WebSocketConnection close event"),this.emit("close",this.closeReasonCode,this.closeDescription)),this._debug("Drop: destroying socket"),this.socket.destroy()},f.prototype.setCloseTimer=function(){this._debug("setCloseTimer"),this.clearCloseTimer(),this._debug("Setting close timer"),this.waitingForCloseResponse=!0,this.closeTimer=setTimeout(this._closeTimerHandler,this.closeTimeout)},f.prototype.clearCloseTimer=function(){this._debug("clearCloseTimer"),this.closeTimer&&(this._debug("Clearing close timer"),clearTimeout(this.closeTimer),this.waitingForCloseResponse=!1,this.closeTimer=null)},f.prototype.handleCloseTimer=function(){this._debug("handleCloseTimer"),this.closeTimer=null,this.waitingForCloseResponse&&(this._debug("Close response not received from client.  Forcing socket end."),this.waitingForCloseResponse=!1,this.state="closed",this.socket.end())},f.prototype.processFrame=function(e){if(this._debug("processFrame"),this._debug(" -- frame: %s",e),0!==this.frameQueue.length&&e.opcode>0&&e.opcode<8)this.drop(f.CLOSE_REASON_PROTOCOL_ERROR,"Illegal frame opcode 0x"+e.opcode.toString(16)+" received in middle of fragmented message.");else switch(e.opcode){case 2:this._debug("-- Binary Frame"),this.assembleFragments&&(e.fin?(this._debug("---- Emitting 'message' event"),this.emit("message",{type:"binary",binaryData:e.binaryPayload})):(this.frameQueue.push(e),this.fragmentationSize=e.length));break;case 1:if(this._debug("-- Text Frame"),this.assembleFragments)if(e.fin){if(!c(e.binaryPayload))return void this.drop(f.CLOSE_REASON_INVALID_DATA,"Invalid UTF-8 Data Received");this._debug("---- Emitting 'message' event"),this.emit("message",{type:"utf8",utf8Data:e.binaryPayload.toString("utf8")})}else this.frameQueue.push(e),this.fragmentationSize=e.length;break;case 0:if(this._debug("-- Continuation Frame"),this.assembleFragments){if(0===this.frameQueue.length)return void this.drop(f.CLOSE_REASON_PROTOCOL_ERROR,"Unexpected Continuation Frame");if(this.fragmentationSize+=e.length,this.fragmentationSize>this.maxReceivedMessageSize)return void this.drop(f.CLOSE_REASON_MESSAGE_TOO_BIG,"Maximum message size exceeded.");if(this.frameQueue.push(e),e.fin){var t=0,s=h(this.fragmentationSize),i=this.frameQueue[0].opcode;switch(this.frameQueue.forEach((function(e){e.binaryPayload.copy(s,t),t+=e.binaryPayload.length})),this.frameQueue=[],this.fragmentationSize=0,i){case 2:this.emit("message",{type:"binary",binaryData:s});break;case 1:if(!c(s))return void this.drop(f.CLOSE_REASON_INVALID_DATA,"Invalid UTF-8 Data Received");this.emit("message",{type:"utf8",utf8Data:s.toString("utf8")});break;default:return void this.drop(f.CLOSE_REASON_PROTOCOL_ERROR,"Unexpected first opcode in fragmentation sequence: 0x"+i.toString(16))}}}break;case 9:if(this._debug("-- Ping Frame"),this._pingListenerCount>0){var n=!1;this.emit("ping",(function(){n=!0}),e.binaryPayload),n||this.pong(e.binaryPayload)}else this.pong(e.binaryPayload);break;case 10:this._debug("-- Pong Frame"),this.emit("pong",e.binaryPayload);break;case 8:if(this._debug("-- Close Frame"),this.waitingForCloseResponse)return this._debug("---- Got close response from peer.  Completing closing handshake."),this.clearCloseTimer(),this.waitingForCloseResponse=!1,this.state="closed",void this.socket.end();var o;if(this._debug("---- Closing handshake initiated by peer."),this.state="peer_requested_close",e.invalidCloseFrameLength?(this.closeReasonCode=1005,o=f.CLOSE_REASON_PROTOCOL_ERROR):-1===e.closeStatus||p(e.closeStatus)?(this.closeReasonCode=e.closeStatus,o=f.CLOSE_REASON_NORMAL):(this.closeReasonCode=e.closeStatus,o=f.CLOSE_REASON_PROTOCOL_ERROR),e.binaryPayload.length>1){if(!c(e.binaryPayload))return void this.drop(f.CLOSE_REASON_INVALID_DATA,"Invalid UTF-8 Data Received");this.closeDescription=e.binaryPayload.toString("utf8")}else this.closeDescription=f.CLOSE_DESCRIPTIONS[this.closeReasonCode];this._debug("------ Remote peer %s - code: %d - %s - close frame payload length: %d",this.remoteAddress,this.closeReasonCode,this.closeDescription,e.length),this._debug("------ responding to remote peer's close request."),this.sendCloseFrame(o,null),this.connected=!1;break;default:this._debug("-- Unrecognized Opcode %d",e.opcode),this.drop(f.CLOSE_REASON_PROTOCOL_ERROR,"Unrecognized Opcode: 0x"+e.opcode.toString(16))}},f.prototype.send=function(e,t){if(this._debug("send"),Buffer.isBuffer(e))this.sendBytes(e,t);else{if("function"!=typeof e.toString)throw new Error("Data provided must either be a Node Buffer or implement toString()");this.sendUTF(e,t)}},f.prototype.sendUTF=function(e,t){e=l(e.toString(),"utf8"),this._debug("sendUTF: %d bytes",e.length);var s=new r(this.maskBytes,this.frameHeader,this.config);s.opcode=1,s.binaryPayload=e,this.fragmentAndSend(s,t)},f.prototype.sendBytes=function(e,t){if(this._debug("sendBytes"),!Buffer.isBuffer(e))throw new Error("You must pass a Node Buffer object to WebSocketConnection.prototype.sendBytes()");var s=new r(this.maskBytes,this.frameHeader,this.config);s.opcode=2,s.binaryPayload=e,this.fragmentAndSend(s,t)},f.prototype.ping=function(e){this._debug("ping");var t=new r(this.maskBytes,this.frameHeader,this.config);t.opcode=9,t.fin=!0,e&&(Buffer.isBuffer(e)||(e=l(e.toString(),"utf8")),e.length>125&&(this._debug("WebSocket: Data for ping is longer than 125 bytes.  Truncating."),e=e.slice(0,124)),t.binaryPayload=e),this.sendFrame(t)},f.prototype.pong=function(e){this._debug("pong");var t=new r(this.maskBytes,this.frameHeader,this.config);t.opcode=10,Buffer.isBuffer(e)&&e.length>125&&(this._debug("WebSocket: Data for pong is longer than 125 bytes.  Truncating."),e=e.slice(0,124)),t.binaryPayload=e,t.fin=!0,this.sendFrame(t)},f.prototype.fragmentAndSend=function(e,t){if(this._debug("fragmentAndSend"),e.opcode>7)throw new Error("You cannot fragment control frames.");var s=this.config.fragmentationThreshold,i=e.binaryPayload.length;if(!this.config.fragmentOutgoingMessages||e.binaryPayload&&i<=s)return e.fin=!0,void this.sendFrame(e,t);for(var n=Math.ceil(i/s),o=0,a=function(e){e?"function"==typeof t&&(t(e),t=null):++o===n&&"function"==typeof t&&t()},c=1;c<=n;c++){var h=new r(this.maskBytes,this.frameHeader,this.config);h.opcode=1===c?e.opcode:0,h.fin=c===n;var l=c===n?i-s*(c-1):s,u=s*(c-1);h.binaryPayload=e.binaryPayload.slice(u,u+l),this.sendFrame(h,a)}},f.prototype.sendCloseFrame=function(e,t,s){if("number"!=typeof e&&(e=f.CLOSE_REASON_NORMAL),this._debug("sendCloseFrame state: %s, reasonCode: %d, description: %s",this.state,e,t),"open"===this.state||"peer_requested_close"===this.state){var i=new r(this.maskBytes,this.frameHeader,this.config);i.fin=!0,i.opcode=8,i.closeStatus=e,"string"==typeof t&&(i.binaryPayload=l(t,"utf8")),this.sendFrame(i,s),this.socket.end()}},f.prototype.sendFrame=function(e,t){this._debug("sendFrame"),e.mask=this.maskOutgoingPackets;var s=this.socket.write(e.toBuffer(),t);return this.outputBufferFull=!s,s},e.exports=f},255:function(e,t,s){for(var i=s(79),n=s(39),o=s(26),r=s(78).EventEmitter,a=s(253),c=/,\s*/,h=/;\s*/,l=/[\r\n]/g,u=/,\s*/,d=["(",")","<",">","@",",",";",":","\\",'"',"/","[","]","?","=","{","}"," ",String.fromCharCode(9)],f=[String.fromCharCode(127)],p=0;p<31;p++)f.push(String.fromCharCode(p));var m=/([\x00-\x20\x22\x28\x29\x2c\x2f\x3a-\x3f\x40\x5b-\x5e\x7b\x7d\x7f])/,b=/[^\x21\x23-\x2b\x2d-\x3a\x3c-\x5b\x5d-\x7e]/,g=/^"[^"]*"$/,v=/[\x00-\x20\x3b]/g,y=/[;,] */,k={100:"Continue",101:"Switching Protocols",200:"OK",201:"Created",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",406:"Not Acceptable",407:"Proxy Authorization Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Long",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported"};function _(e,t,s){r.call(this),this.socket=e,this.httpRequest=t,this.resource=t.url,this.remoteAddress=e.remoteAddress,this.remoteAddresses=[this.remoteAddress],this.serverConfig=s,this._socketIsClosing=!1,this._socketCloseHandler=this._handleSocketCloseBeforeAccept.bind(this),this.socket.on("end",this._socketCloseHandler),this.socket.on("close",this._socketCloseHandler),this._resolved=!1}function E(e){process.nextTick((function(){e.drop(1006,"TCP connection lost before handshake completed.",!0)}))}n.inherits(_,r),_.prototype.readHandshake=function(){var e=this,t=this.httpRequest;if(this.resourceURL=o.parse(this.resource,!0),this.host=t.headers.host,!this.host)throw new Error("Client must provide a Host header.");if(this.key=t.headers["sec-websocket-key"],!this.key)throw new Error("Client must provide a value for Sec-WebSocket-Key.");if(this.webSocketVersion=parseInt(t.headers["sec-websocket-version"],10),!this.webSocketVersion||isNaN(this.webSocketVersion))throw new Error("Client must provide a value for Sec-WebSocket-Version.");switch(this.webSocketVersion){case 8:case 13:break;default:var s=new Error("Unsupported websocket client version: "+this.webSocketVersion+"Only versions 8 and 13 are supported.");throw s.httpCode=426,s.headers={"Sec-WebSocket-Version":"13"},s}13===this.webSocketVersion?this.origin=t.headers.origin:8===this.webSocketVersion&&(this.origin=t.headers["sec-websocket-origin"]);var i=t.headers["sec-websocket-protocol"];(this.protocolFullCaseMap={},this.requestedProtocols=[],i)&&i.split(c).forEach((function(t){var s=t.toLocaleLowerCase();e.requestedProtocols.push(s),e.protocolFullCaseMap[s]=t}));if(!this.serverConfig.ignoreXForwardedFor&&t.headers["x-forwarded-for"]){var n=this.remoteAddress;this.remoteAddresses=t.headers["x-forwarded-for"].split(u),this.remoteAddresses.push(n),this.remoteAddress=this.remoteAddresses[0]}if(this.serverConfig.parseExtensions){var r=t.headers["sec-websocket-extensions"];this.requestedExtensions=this.parseExtensions(r)}else this.requestedExtensions=[];if(this.serverConfig.parseCookies){var a=t.headers.cookie;this.cookies=this.parseCookies(a)}else this.cookies=[]},_.prototype.parseExtensions=function(e){if(!e||0===e.length)return[];var t=e.toLocaleLowerCase().split(c);return t.forEach((function(e,t,s){var i=e.split(h),n=i[0],o=i.slice(1);o.forEach((function(e,t,s){var i=e.split("="),n={name:i[0],value:i[1]};s.splice(t,1,n)}));var r={name:n,params:o};s.splice(t,1,r)})),t},_.prototype.parseCookies=function(e){if(!e||"string"!=typeof e)return[];var t=[];return e.split(y).forEach((function(e){var s=e.indexOf("=");if(-1!==s){var i=e.substr(0,s).trim(),n=e.substr(++s,e.length).trim();'"'===n[0]&&(n=n.slice(1,-1)),t.push({name:i,value:decodeURIComponent(n)})}else t.push({name:e,value:null})})),t},_.prototype.accept=function(e,t,s){var n;this._verifyResolution(),e?void 0===(n=this.protocolFullCaseMap[e.toLocaleLowerCase()])&&(n=e):n=e,this.protocolFullCaseMap=null;var o=i.createHash("sha1");o.update(this.key+"258EAFA5-E914-47DA-95CA-C5AB0DC85B11");var r="HTTP/1.1 101 Switching Protocols\r\nUpgrade: websocket\r\nConnection: Upgrade\r\nSec-WebSocket-Accept: "+o.digest("base64")+"\r\n";if(n){for(var c=0;c<n.length;c++){var h=n.charCodeAt(c),u=n.charAt(c);if(h<33||h>126||-1!==d.indexOf(u))throw this.reject(500),new Error('Illegal character "'+String.fromCharCode(u)+'" in subprotocol.')}if(-1===this.requestedProtocols.indexOf(e))throw this.reject(500),new Error("Specified protocol was not requested by the client.");n=n.replace(l,""),r+="Sec-WebSocket-Protocol: "+n+"\r\n"}if(this.requestedProtocols=null,t&&(t=t.replace(l,""),13===this.webSocketVersion?r+="Origin: "+t+"\r\n":8===this.webSocketVersion&&(r+="Sec-WebSocket-Origin: "+t+"\r\n")),s){if(!Array.isArray(s))throw this.reject(500),new Error('Value supplied for "cookies" argument must be an array.');var f={};s.forEach(function(e){if(!e.name||!e.value)throw this.reject(500),new Error('Each cookie to set must at least provide a "name" and "value"');if(e.name=e.name.replace(v,""),e.value=e.value.replace(v,""),f[e.name])throw this.reject(500),new Error("You may not specify the same cookie name twice.");f[e.name]=!0;var t=e.name.match(m);if(t)throw this.reject(500),new Error("Illegal character "+t[0]+" in cookie name");if(t=e.value.match(g)?e.value.slice(1,-1).match(b):e.value.match(b))throw this.reject(500),new Error("Illegal character "+t[0]+" in cookie value");var s=[e.name+"="+e.value];if(e.path){if(t=e.path.match(v))throw this.reject(500),new Error("Illegal character "+t[0]+" in cookie path");s.push("Path="+e.path)}if(e.domain){if("string"!=typeof e.domain)throw this.reject(500),new Error("Domain must be specified and must be a string.");if(t=e.domain.match(v))throw this.reject(500),new Error("Illegal character "+t[0]+" in cookie domain");s.push("Domain="+e.domain.toLowerCase())}if(e.expires){if(!(e.expires instanceof Date))throw this.reject(500),new Error('Value supplied for cookie "expires" must be a vaild date object');s.push("Expires="+e.expires.toGMTString())}if(e.maxage){var i=e.maxage;if("string"==typeof i&&(i=parseInt(i,10)),isNaN(i)||i<=0)throw this.reject(500),new Error('Value supplied for cookie "maxage" must be a non-zero number');i=Math.round(i),s.push("Max-Age="+i.toString(10))}if(e.secure){if("boolean"!=typeof e.secure)throw this.reject(500),new Error('Value supplied for cookie "secure" must be of type boolean');s.push("Secure")}if(e.httponly){if("boolean"!=typeof e.httponly)throw this.reject(500),new Error('Value supplied for cookie "httponly" must be of type boolean');s.push("HttpOnly")}r+="Set-Cookie: "+s.join(";")+"\r\n"}.bind(this))}this._resolved=!0,this.emit("requestResolved",this),r+="\r\n";var p=new a(this.socket,[],e,!1,this.serverConfig);p.webSocketVersion=this.webSocketVersion,p.remoteAddress=this.remoteAddress,p.remoteAddresses=this.remoteAddresses;var y=this;return this._socketIsClosing?E(p):this.socket.write(r,"ascii",(function(e){e?E(p):(y._removeSocketCloseListeners(),p._addSocketEventListeners())})),this.emit("requestAccepted",p),p},_.prototype.reject=function(e,t,s){this._verifyResolution(),this._resolved=!0,this.emit("requestResolved",this),"number"!=typeof e&&(e=403);var i="HTTP/1.1 "+e+" "+k[e]+"\r\nConnection: close\r\n";if(t&&(i+="X-WebSocket-Reject-Reason: "+(t=t.replace(l,""))+"\r\n"),s)for(var n in s){var o=s[n].toString().replace(l,"");i+=n.replace(l,"")+": "+o+"\r\n"}i+="\r\n",this.socket.end(i,"ascii"),this.emit("requestRejected",this)},_.prototype._handleSocketCloseBeforeAccept=function(){this._socketIsClosing=!0,this._removeSocketCloseListeners()},_.prototype._removeSocketCloseListeners=function(){this.socket.removeListener("end",this._socketCloseHandler),this.socket.removeListener("close",this._socketCloseHandler)},_.prototype._verifyResolution=function(){if(this._resolved)throw new Error("WebSocketRequest may only be accepted or rejected one time.")},e.exports=_},256:function(e,t,s){var i=s(265),n=s(250).bufferAllocUnsafe;function o(e,t,s){this.maskBytes=e,this.frameHeader=t,this.config=s,this.maxReceivedFrameSize=s.maxReceivedFrameSize,this.protocolError=!1,this.frameTooLarge=!1,this.invalidCloseFrameLength=!1,this.parseState=1,this.closeStatus=-1}o.prototype.addData=function(e){if(1===this.parseState&&e.length>=2){e.joinInto(this.frameHeader,0,0,2),e.advance(2);var t=this.frameHeader[0],s=this.frameHeader[1];if(this.fin=Boolean(128&t),this.rsv1=Boolean(64&t),this.rsv2=Boolean(32&t),this.rsv3=Boolean(16&t),this.mask=Boolean(128&s),this.opcode=15&t,this.length=127&s,this.opcode>=8){if(this.length>125)return this.protocolError=!0,this.dropReason="Illegal control frame longer than 125 bytes.",!0;if(!this.fin)return this.protocolError=!0,this.dropReason="Control frames must not be fragmented.",!0}126===this.length?this.parseState=2:127===this.length?this.parseState=3:this.parseState=4}if(2===this.parseState)e.length>=2&&(e.joinInto(this.frameHeader,2,0,2),e.advance(2),this.length=this.frameHeader.readUInt16BE(2),this.parseState=4);else if(3===this.parseState&&e.length>=8){e.joinInto(this.frameHeader,2,0,8),e.advance(8);var o=[this.frameHeader.readUInt32BE(2),this.frameHeader.readUInt32BE(6)];if(0!==o[0])return this.protocolError=!0,this.dropReason="Unsupported 64-bit length frame received",!0;this.length=o[1],this.parseState=4}if(4===this.parseState&&(this.mask?e.length>=4&&(e.joinInto(this.maskBytes,0,0,4),e.advance(4),this.parseState=5):this.parseState=5),5===this.parseState){if(this.length>this.maxReceivedFrameSize)return this.frameTooLarge=!0,this.dropReason="Frame size of "+this.length.toString(10)+" bytes exceeds maximum accepted frame size",!0;if(0===this.length)return this.binaryPayload=n(0),this.parseState=6,!0;if(e.length>=this.length)return this.binaryPayload=e.take(this.length),e.advance(this.length),this.mask&&i.unmask(this.binaryPayload,this.maskBytes),8===this.opcode&&(1===this.length&&(this.binaryPayload=n(0),this.invalidCloseFrameLength=!0),this.length>=2&&(this.closeStatus=this.binaryPayload.readUInt16BE(0),this.binaryPayload=this.binaryPayload.slice(2))),this.parseState=6,!0}return!1},o.prototype.throwAwayPayload=function(e){return e.length>=this.length&&(e.advance(this.length),this.parseState=6,!0)},o.prototype.toBuffer=function(e){var t,s,o,r=2,a=0,c=0;this.fin&&(a|=128),this.rsv1&&(a|=64),this.rsv2&&(a|=32),this.rsv3&&(a|=16),this.mask&&(c|=128),a|=15&this.opcode,8===this.opcode?(this.length=2,this.binaryPayload&&(this.length+=this.binaryPayload.length),(s=n(this.length)).writeUInt16BE(this.closeStatus,0),this.length>2&&this.binaryPayload.copy(s,2)):this.binaryPayload?(s=this.binaryPayload,this.length=s.length):this.length=0,this.length<=125?c|=127&this.length:this.length>125&&this.length<=65535?(c|=126,r+=2):this.length>65535&&(c|=127,r+=8);var h=n(this.length+r+(this.mask?4:0));return h[0]=a,h[1]=c,o=2,this.length>125&&this.length<=65535?(h.writeUInt16BE(this.length,o),o+=2):this.length>65535&&(h.writeUInt32BE(0,o),h.writeUInt32BE(this.length,o+4),o+=8),this.mask?(t=e?0:4294967295*Math.random()>>>0,this.maskBytes.writeUInt32BE(t,0),this.maskBytes.copy(h,o),o+=4,s&&i.mask(s,this.maskBytes,h,o,this.length)):s&&s.copy(h,o),h},o.prototype.toString=function(){return"Opcode: "+this.opcode+", fin: "+this.fin+", length: "+this.length+", hasPayload: "+Boolean(this.binaryPayload)+", masked: "+this.mask},e.exports=o},257:function(e,t,s){"function"==typeof process.addon?e.exports=process.addon.bind(process):e.exports=s(266)},258:function(e,t,s){var i=s(250),n=i.extend,o=s(39),r=s(78).EventEmitter,a=s(20),c=s(80),h=s(26),l=s(79),u=s(253),d=i.bufferAllocUnsafe,f=["(",")","<",">","@",",",";",":","\\",'"',"/","[","]","?","=","{","}"," ",String.fromCharCode(9)],p=["hostname","port","method","path","headers"];function m(e){var t;(r.call(this),this.config={maxReceivedFrameSize:1048576,maxReceivedMessageSize:8388608,fragmentOutgoingMessages:!0,fragmentationThreshold:16384,webSocketVersion:13,assembleFragments:!0,disableNagleAlgorithm:!0,closeTimeout:5e3,tlsOptions:{}},e)&&(e.tlsOptions?(t=e.tlsOptions,delete e.tlsOptions):t={},n(this.config,e),n(this.config.tlsOptions,t));switch(this._req=null,this.config.webSocketVersion){case 8:case 13:break;default:throw new Error("Requested webSocketVersion is not supported. Allowed values are 8 and 13.")}}o.inherits(m,r),m.prototype.connect=function(e,t,s,o,r){var l=this;if("string"==typeof t&&(t=t.length>0?[t]:[]),t instanceof Array||(t=[]),this.protocols=t,this.origin=s,this.url="string"==typeof e?h.parse(e):e,!this.url.protocol)throw new Error("You must specify a full WebSocket URL, including protocol.");if(!this.url.host)throw new Error("You must specify a full WebSocket URL, including hostname. Relative URLs are not supported.");this.secure="wss:"===this.url.protocol,this.protocols.forEach((function(e){for(var t=0;t<e.length;t++){var s=e.charCodeAt(t),i=e.charAt(t);if(s<33||s>126||-1!==f.indexOf(i))throw new Error('Protocol list contains invalid character "'+String.fromCharCode(s)+'"')}}));this.url.port||(this.url.port={"ws:":"80","wss:":"443"}[this.url.protocol]);for(var u=d(16),m=0;m<16;m++)u[m]=Math.round(255*Math.random());this.base64nonce=u.toString("base64");var b=this.url.hostname;("ws:"===this.url.protocol&&"80"!==this.url.port||"wss:"===this.url.protocol&&"443"!==this.url.port)&&(b+=":"+this.url.port);var g,v={};function y(e){l._req=null,l.emit("connectFailed",e)}this.secure&&this.config.tlsOptions.hasOwnProperty("headers")&&n(v,this.config.tlsOptions.headers),o&&n(v,o),n(v,{Upgrade:"websocket",Connection:"Upgrade","Sec-WebSocket-Version":this.config.webSocketVersion.toString(10),"Sec-WebSocket-Key":this.base64nonce,Host:v.Host||b}),this.protocols.length>0&&(v["Sec-WebSocket-Protocol"]=this.protocols.join(", ")),this.origin&&(13===this.config.webSocketVersion?v.Origin=this.origin:8===this.config.webSocketVersion&&(v["Sec-WebSocket-Origin"]=this.origin)),g=this.url.pathname?this.url.path:this.url.path?"/"+this.url.path:"/";var k={agent:!1};if(r&&n(k,r),n(k,{hostname:this.url.hostname,port:this.url.port,method:"GET",path:g,headers:v}),this.secure){var _=this.config.tlsOptions;for(var E in _)_.hasOwnProperty(E)&&-1===p.indexOf(E)&&(k[E]=_[E])}var w=this._req=(this.secure?c:a).request(k);w.on("upgrade",(function(e,t,s){l._req=null,w.removeListener("error",y),l.socket=t,l.response=e,l.firstDataChunk=s,l.validateHandshake()})),w.on("error",y),w.on("response",(function(e){if(l._req=null,i.eventEmitterListenerCount(l,"httpResponse")>0)l.emit("httpResponse",e,l),e.socket&&e.socket.end();else{var t=[];for(var s in e.headers)t.push(s+": "+e.headers[s]);l.failHandshake("Server responded with a non-101 status: "+e.statusCode+" "+e.statusMessage+"\nResponse Headers Follow:\n"+t.join("\n")+"\n")}})),w.end()},m.prototype.validateHandshake=function(){var e=this.response.headers;if(this.protocols.length>0){if(this.protocol=e["sec-websocket-protocol"],!this.protocol)return void this.failHandshake("Expected a Sec-WebSocket-Protocol header.");if(-1===this.protocols.indexOf(this.protocol))return void this.failHandshake("Server did not respond with a requested protocol.")}if(e.connection&&"upgrade"===e.connection.toLocaleLowerCase())if(e.upgrade&&"websocket"===e.upgrade.toLocaleLowerCase()){var t=l.createHash("sha1");t.update(this.base64nonce+"258EAFA5-E914-47DA-95CA-C5AB0DC85B11");var s=t.digest("base64");e["sec-websocket-accept"]?e["sec-websocket-accept"]===s?this.succeedHandshake():this.failHandshake("Sec-WebSocket-Accept header from server didn't match expected value of "+s):this.failHandshake("Expected Sec-WebSocket-Accept header from server")}else this.failHandshake("Expected an Upgrade: websocket header from the server");else this.failHandshake("Expected a Connection: Upgrade header from the server")},m.prototype.failHandshake=function(e){this.socket&&this.socket.writable&&this.socket.end(),this.emit("connectFailed",new Error(e))},m.prototype.succeedHandshake=function(){var e=new u(this.socket,[],this.protocol,!0,this.config);e.webSocketVersion=this.config.webSocketVersion,e._addSocketEventListeners(),this.emit("connect",e),this.firstDataChunk.length>0&&e.handleSocketData(this.firstDataChunk),this.firstDataChunk=null},m.prototype.abort=function(){this._req&&this._req.abort()},e.exports=m},261:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(t,s,i){if(void 0===i&&(i={}),this.url=t,this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this.ondown=null,this.onreopen=null,this.CONNECTING=e.CONNECTING,this.OPEN=e.OPEN,this.CLOSING=e.CLOSING,this.CLOSED=e.CLOSED,this.hasBeenOpened=!1,this.isClosed=!1,this.messageBuffer=[],this.nextRetryTime=0,this.reconnectCount=0,this.lastKnownExtensions="",this.lastKnownProtocol="",this.listeners={},null==s||"string"==typeof s||Array.isArray(s)?this.protocols=s:i=s,this.options=n(i),!this.options.wsConstructor){if("undefined"==typeof WebSocket)throw new Error("WebSocket not present in global scope and no wsConstructor option was provided.");this.options.wsConstructor=WebSocket}this.openNewWebSocket()}return Object.defineProperty(e.prototype,"binaryType",{get:function(){return this.binaryTypeInternal||"blob"},set:function(e){this.binaryTypeInternal=e,this.ws&&(this.ws.binaryType=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bufferedAmount",{get:function(){var e=this.ws?this.ws.bufferedAmount:0,t=!1;return this.messageBuffer.forEach((function(s){var i=function(e){return"string"==typeof e?2*e.length:e instanceof ArrayBuffer?e.byteLength:e instanceof Blob?e.size:void 0}(s);null!=i?e+=i:t=!0})),t&&this.debugLog("Some buffered data had unknown length. bufferedAmount() return value may be below the correct amount."),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extensions",{get:function(){return this.ws?this.ws.extensions:this.lastKnownExtensions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"protocol",{get:function(){return this.ws?this.ws.protocol:this.lastKnownProtocol},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:function(){return this.isClosed?e.CLOSED:e.OPEN},enumerable:!0,configurable:!0}),e.prototype.close=function(e,t){this.disposeSocket(e,t),this.shutdown(),this.debugLog("WebSocket permanently closed by client.")},e.prototype.send=function(e){if(this.isClosed)throw new Error("WebSocket is already in CLOSING or CLOSED state.");this.ws&&this.ws.readyState===this.OPEN?this.ws.send(e):this.messageBuffer.push(e)},e.prototype.reconnect=function(){if(this.isClosed)throw new Error("Cannot call reconnect() on socket which is permanently closed.");this.disposeSocket(1e3,"Client requested reconnect."),this.handleClose(void 0)},e.prototype.addEventListener=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},e.prototype.dispatchEvent=function(e){return this.dispatchEventOfType(e.type,e)},e.prototype.removeEventListener=function(e,t){this.listeners[e]&&(this.listeners[e]=this.listeners[e].filter((function(e){return e!==t})))},e.prototype.openNewWebSocket=function(){var e=this;if(!this.isClosed){var t=this.options,s=t.connectTimeout,i=t.wsConstructor;this.debugLog("Opening new WebSocket to "+this.url+".");var n=new i(this.url,this.protocols);n.onclose=function(t){return e.handleClose(t)},n.onerror=function(t){return e.handleError(t)},n.onmessage=function(t){return e.handleMessage(t)},n.onopen=function(t){return e.handleOpen(t)},this.connectTimeoutId=setTimeout((function(){e.clearConnectTimeout(),e.disposeSocket(),e.handleClose(void 0)}),s),this.ws=n}},e.prototype.handleOpen=function(e){var t=this;if(this.ws&&!this.isClosed){var s=this.options.allClearResetTime;this.debugLog("WebSocket opened."),null!=this.binaryTypeInternal?this.ws.binaryType=this.binaryTypeInternal:this.binaryTypeInternal=this.ws.binaryType,this.clearConnectTimeout(),this.hasBeenOpened?this.dispatchEventOfType("reopen",e):(this.dispatchEventOfType("open",e),this.hasBeenOpened=!0),this.messageBuffer.forEach((function(e){return t.send(e)})),this.messageBuffer=[],this.allClearTimeoutId=setTimeout((function(){t.clearAllClearTimeout(),t.nextRetryTime=0,t.reconnectCount=0;var e=s/1e3|0;t.debugLog("WebSocket remained open for "+e+" seconds. Resetting retry time and count.")}),s)}},e.prototype.handleMessage=function(e){this.isClosed||this.dispatchEventOfType("message",e)},e.prototype.handleClose=function(e){var t=this;if(!this.isClosed){var s=this.options,i=s.maxReconnectAttempts,n=s.shouldReconnect;if(this.clearConnectTimeout(),this.clearAllClearTimeout(),this.ws&&(this.lastKnownExtensions=this.ws.extensions,this.lastKnownProtocol=this.ws.protocol,this.disposeSocket()),this.dispatchEventOfType("down",e),this.reconnectCount>=i)this.stopReconnecting(e,this.getTooManyFailedReconnectsMessage());else{var o=!e||n(e);"boolean"==typeof o?this.handleWillReconnect(o,e,"Provided shouldReconnect() returned false. Closing permanently."):o.then((function(s){t.isClosed||t.handleWillReconnect(s,e,"Provided shouldReconnect() resolved to false. Closing permanently.")}))}}},e.prototype.handleError=function(e){this.dispatchEventOfType("error",e),this.debugLog("WebSocket encountered an error.")},e.prototype.handleWillReconnect=function(e,t,s){e?this.reestablishConnection():this.stopReconnecting(t,s)},e.prototype.reestablishConnection=function(){var e=this,t=this.options,s=t.minReconnectDelay,i=t.maxReconnectDelay,n=t.reconnectBackoffFactor;this.reconnectCount++;var o=this.nextRetryTime;this.nextRetryTime=Math.max(s,Math.min(this.nextRetryTime*n,i)),setTimeout((function(){return e.openNewWebSocket()}),o);var r=o/1e3|0;this.debugLog("WebSocket was closed. Re-opening in "+r+" seconds.")},e.prototype.stopReconnecting=function(e,t){this.debugLog(t),this.shutdown(),e&&this.dispatchEventOfType("close",e)},e.prototype.shutdown=function(){this.isClosed=!0,this.clearAllTimeouts(),this.messageBuffer=[],this.disposeSocket()},e.prototype.disposeSocket=function(e,t){this.ws&&(this.ws.onerror=o,this.ws.onclose=o,this.ws.onmessage=o,this.ws.onopen=o,this.ws.close(e,t),this.ws=void 0)},e.prototype.clearAllTimeouts=function(){this.clearConnectTimeout(),this.clearAllClearTimeout()},e.prototype.clearConnectTimeout=function(){null!=this.connectTimeoutId&&(clearTimeout(this.connectTimeoutId),this.connectTimeoutId=void 0)},e.prototype.clearAllClearTimeout=function(){null!=this.allClearTimeoutId&&(clearTimeout(this.allClearTimeoutId),this.allClearTimeoutId=void 0)},e.prototype.dispatchEventOfType=function(e,t){var s=this;switch(e){case"close":this.onclose&&this.onclose(t);break;case"error":this.onerror&&this.onerror(t);break;case"message":this.onmessage&&this.onmessage(t);break;case"open":this.onopen&&this.onopen(t);break;case"down":this.ondown&&this.ondown(t);break;case"reopen":this.onreopen&&this.onreopen(t)}return e in this.listeners&&this.listeners[e].slice().forEach((function(e){return s.callListener(e,t)})),!t||!t.defaultPrevented},e.prototype.callListener=function(e,t){"function"==typeof e?e.call(this,t):e.handleEvent.call(this,t)},e.prototype.debugLog=function(e){this.options.debug&&console.log(e)},e.prototype.getTooManyFailedReconnectsMessage=function(){var e,t=this.options.maxReconnectAttempts;return"Failed to reconnect after "+t+" "+(e="attempt",(1===t?e:e+"s")+". Closing permanently.")},e.DEFAULT_OPTIONS={allClearResetTime:5e3,connectTimeout:5e3,debug:!1,minReconnectDelay:1e3,maxReconnectDelay:3e4,maxReconnectAttempts:Number.POSITIVE_INFINITY,reconnectBackoffFactor:1.5,shouldReconnect:function(){return!0},wsConstructor:void 0},e.CONNECTING=0,e.OPEN=1,e.CLOSING=2,e.CLOSED=3,e}();function n(e){var t={};return Object.keys(i.DEFAULT_OPTIONS).forEach((function(s){var n=e[s];t[s]=void 0===n?i.DEFAULT_OPTIONS[s]:n})),t}function o(){}t.default=i},262:function(e,t,s){e.exports=s(263)},263:function(e,t,s){e.exports={server:s(264),client:s(258),router:s(271),frame:s(256),request:s(255),connection:s(253),w3cwebsocket:s(273),deprecation:s(279),version:s(280)}},264:function(e,t,s){var i=s(250).extend,n=s(250),o=s(39),r=s(13)("websocket:server"),a=s(78).EventEmitter,c=s(255),h=function(e){a.call(this),this._handlers={upgrade:this.handleUpgrade.bind(this),requestAccepted:this.handleRequestAccepted.bind(this),requestResolved:this.handleRequestResolved.bind(this)},this.connections=[],this.pendingRequests=[],e&&this.mount(e)};o.inherits(h,a),h.prototype.mount=function(e){if(this.config={httpServer:null,maxReceivedFrameSize:65536,maxReceivedMessageSize:1048576,fragmentOutgoingMessages:!0,fragmentationThreshold:16384,keepalive:!0,keepaliveInterval:2e4,dropConnectionOnKeepaliveTimeout:!0,keepaliveGracePeriod:1e4,useNativeKeepalive:!1,assembleFragments:!0,autoAcceptConnections:!1,ignoreXForwardedFor:!1,parseCookies:!0,parseExtensions:!0,disableNagleAlgorithm:!0,closeTimeout:5e3},i(this.config,e),!this.config.httpServer)throw new Error("You must specify an httpServer on which to mount the WebSocket server.");Array.isArray(this.config.httpServer)||(this.config.httpServer=[this.config.httpServer]);var t=this._handlers.upgrade;this.config.httpServer.forEach((function(e){e.on("upgrade",t)}))},h.prototype.unmount=function(){var e=this._handlers.upgrade;this.config.httpServer.forEach((function(t){t.removeListener("upgrade",e)}))},h.prototype.closeAllConnections=function(){this.connections.forEach((function(e){e.close()})),this.pendingRequests.forEach((function(e){process.nextTick((function(){e.reject(503)}))}))},h.prototype.broadcast=function(e){Buffer.isBuffer(e)?this.broadcastBytes(e):"function"==typeof e.toString&&this.broadcastUTF(e)},h.prototype.broadcastUTF=function(e){this.connections.forEach((function(t){t.sendUTF(e)}))},h.prototype.broadcastBytes=function(e){this.connections.forEach((function(t){t.sendBytes(e)}))},h.prototype.shutDown=function(){this.unmount(),this.closeAllConnections()},h.prototype.handleUpgrade=function(e,t){var s=this,i=new c(t,e,this.config);try{i.readHandshake()}catch(e){return i.reject(e.httpCode?e.httpCode:400,e.message,e.headers),r("Invalid handshake: %s",e.message),void this.emit("upgradeError",e)}this.pendingRequests.push(i),i.once("requestAccepted",this._handlers.requestAccepted),i.once("requestResolved",this._handlers.requestResolved),t.once("close",(function(){s._handlers.requestResolved(i)})),!this.config.autoAcceptConnections&&n.eventEmitterListenerCount(this,"request")>0?this.emit("request",i):this.config.autoAcceptConnections?i.accept(i.requestedProtocols[0],i.origin):i.reject(404,"No handler is configured to accept the connection.")},h.prototype.handleRequestAccepted=function(e){var t=this;e.once("close",(function(s,i){t.handleConnectionClose(e,s,i)})),this.connections.push(e),this.emit("connect",e)},h.prototype.handleConnectionClose=function(e,t,s){var i=this.connections.indexOf(e);-1!==i&&this.connections.splice(i,1),this.emit("close",e,t,s)},h.prototype.handleRequestResolved=function(e){var t=this.pendingRequests.indexOf(e);-1!==t&&this.pendingRequests.splice(t,1)},e.exports=h},265:function(e,t,s){"use strict";(function(t){try{e.exports=s(257)(t)}catch(t){e.exports=s(267)}}).call(this,"/")},266:function(e,t,s){var i=s(27),n=s(19),o=s(243),r=require,a=process.config&&process.config.variables||{},c=!!process.env.PREBUILDS_ONLY,h=process.versions.modules,l=!(!process.versions||!process.versions.electron)||!!process.env.ELECTRON_RUN_AS_NODE||"undefined"!=typeof window&&window.process&&"renderer"===window.process.type?"electron":process.versions&&process.versions.nw?"node-webkit":"node",u=process.env.npm_config_arch||o.arch(),d=process.env.npm_config_platform||o.platform(),f=process.env.LIBC||(function(e){return"linux"===e&&i.existsSync("/etc/alpine-release")}(d)?"musl":"glibc"),p=process.env.ARM_VERSION||("arm64"===u?"8":a.arm_version)||"",m=(process.versions.uv||"").split(".")[0];function b(e){return r(b.resolve(e))}function g(e){try{return i.readdirSync(e)}catch(e){return[]}}function v(e,t){var s=g(e).filter(t);return s[0]&&n.join(e,s[0])}function y(e){return/\.node$/.test(e)}function k(e){var t=e.split("-");if(2===t.length){var s=t[0],i=t[1].split("+");if(s&&i.length&&i.every(Boolean))return{name:e,platform:s,architectures:i}}}function _(e,t){return function(s){return null!=s&&(s.platform===e&&s.architectures.includes(t))}}function E(e,t){return e.architectures.length-t.architectures.length}function w(e){var t=e.split("."),s={file:e,specificity:0};if("node"===t.pop()){for(var i=0;i<t.length;i++){var n=t[i];if("node"===n||"electron"===n||"node-webkit"===n)s.runtime=n;else if("napi"===n)s.napi=!0;else if("abi"===n.slice(0,3))s.abi=n.slice(3);else if("uv"===n.slice(0,2))s.uv=n.slice(2);else if("armv"===n.slice(0,4))s.armv=n.slice(4);else{if("glibc"!==n&&"musl"!==n)continue;s.libc=n}s.specificity++}return s}}function S(e,t){return function(s){return null!=s&&(!(s.runtime!==e&&!function(e){return"node"===e.runtime&&e.napi}(s))&&(!(s.abi!==t&&!s.napi)&&((!s.uv||s.uv===m)&&((!s.armv||s.armv===p)&&(!s.libc||s.libc===f)))))}}function O(e){return function(t,s){return t.runtime!==s.runtime?t.runtime===e?-1:1:t.abi!==s.abi?t.abi?-1:1:t.specificity!==s.specificity?t.specificity>s.specificity?-1:1:0}}e.exports=b,b.resolve=b.path=function(e){e=n.resolve(e||".");try{var t=r(n.join(e,"package.json")).name.toUpperCase().replace(/-/g,"_");process.env[t+"_PREBUILD"]&&(e=process.env[t+"_PREBUILD"])}catch(e){}if(!c){var s=v(n.join(e,"build/Release"),y);if(s)return s;var i=v(n.join(e,"build/Debug"),y);if(i)return i}var o=C(e);if(o)return o;var a=C(n.dirname(process.execPath));if(a)return a;var b=["platform="+d,"arch="+u,"runtime="+l,"abi="+h,"uv="+m,p?"armv="+p:"","libc="+f,"node="+process.versions.node,process.versions.electron?"electron="+process.versions.electron:"","webpack=true"].filter(Boolean).join(" ");throw new Error("No native build was found for "+b+"\n    loaded from: "+e+"\n");function C(e){var t=g(n.join(e,"prebuilds")).map(k).filter(_(d,u)).sort(E)[0];if(t){var s=n.join(e,"prebuilds",t.name),i=g(s).map(w).filter(S(l,h)).sort(O(l))[0];return i?n.join(s,i.file):void 0}}},b.parseTags=w,b.matchTags=S,b.compareTags=O,b.parseTuple=k,b.matchTuple=_,b.compareTuples=E},267:function(e,t,s){"use strict";e.exports={mask:(e,t,s,i,n)=>{for(var o=0;o<n;o++)s[i+o]=e[o]^t[3&o]},unmask:(e,t)=>{const s=e.length;for(var i=0;i<s;i++)e[i]^=t[3&i]}}},268:function(e,t,s){var i=s(24).Buffer,n=s(78).EventEmitter,o=s(250).bufferAllocUnsafe;function r(e){if(!(this instanceof r))return new r(e);n.call(this);var t=this;void 0===e&&(e={}),t.encoding=e.encoding;var s={next:null,buffer:null},a={next:null,buffer:null},c=0;t.__defineGetter__("length",(function(){return c}));var h=0;t.write=function(e){return s.buffer?(a.next={next:null,buffer:e},a=a.next):(s.buffer=e,a=s),c+=e.length,t.emit("write",e),!0},t.end=function(e){i.isBuffer(e)&&t.write(e)},t.push=function(){var e=[].concat.apply([],arguments);return e.forEach(t.write),t},t.forEach=function(e){if(!s.buffer)return o(0);if(s.buffer.length-h<=0)return t;for(var i={buffer:s.buffer.slice(h),next:s.next};i&&i.buffer;){if(e(i.buffer))break;i=i.next}return t},t.join=function(e,i){if(!s.buffer)return o(0);null==e&&(e=0),null==i&&(i=t.length);var n=o(i-e),r=0;return t.forEach((function(t){if(e<r+t.length&&r<i&&t.copy(n,Math.max(0,r-e),Math.max(0,e-r),Math.min(t.length,i-r)),(r+=t.length)>i)return!0})),n},t.joinInto=function(e,i,n,r){if(!s.buffer)return new o(0);null==n&&(n=0),null==r&&(r=t.length);var a=e;if(a.length-i<r-n)throw new Error("Insufficient space available in target Buffer.");var c=0;return t.forEach((function(e){if(n<c+e.length&&c<r&&e.copy(a,Math.max(i,i+c-n),Math.max(0,n-c),Math.min(e.length,r-c)),(c+=e.length)>r)return!0})),a},t.advance=function(e){for(h+=e,c-=e;s.buffer&&h>=s.buffer.length;)h-=s.buffer.length,s=s.next?s.next:{buffer:null,next:null};return null===s.buffer&&(a={next:null,buffer:null}),t.emit("advance",e),t},t.take=function(e,s){null==e?e=t.length:"number"!=typeof e&&(s=e,e=t.length);if(s||(s=t.encoding),s){var i="";return t.forEach((function(t){if(e<=0)return!0;i+=t.toString(s,0,Math.min(e,t.length)),e-=t.length})),i}return t.join(0,e)},t.toString=function(){return t.take("binary")}}e.exports=r,e.exports.BufferList=r,s(39).inherits(r,n)},269:function(e,t,s){"use strict";(function(t){try{e.exports=s(257)(t)}catch(t){e.exports=s(270)}}).call(this,"/")},270:function(e,t,s){"use strict";e.exports=function(e){const t=e.length;let s=0;for(;s<t;)if(0==(128&e[s]))s++;else if(192==(224&e[s])){if(s+1===t||128!=(192&e[s+1])||192==(254&e[s]))return!1;s+=2}else if(224==(240&e[s])){if(s+2>=t||128!=(192&e[s+1])||128!=(192&e[s+2])||224===e[s]&&128==(224&e[s+1])||237===e[s]&&160==(224&e[s+1]))return!1;s+=3}else{if(240!=(248&e[s]))return!1;if(s+3>=t||128!=(192&e[s+1])||128!=(192&e[s+2])||128!=(192&e[s+3])||240===e[s]&&128==(240&e[s+1])||244===e[s]&&e[s+1]>143||e[s]>244)return!1;s+=4}return!0}},271:function(e,t,s){var i=s(250).extend,n=s(39),o=s(78).EventEmitter,r=s(272);function a(e){o.call(this),this.config={server:null},e&&i(this.config,e),this.handlers=[],this._requestHandler=this.handleRequest.bind(this),this.config.server&&this.attachServer(this.config.server)}n.inherits(a,o),a.prototype.attachServer=function(e){if(!e)throw new Error("You must specify a WebSocketServer instance to attach to.");this.server=e,this.server.on("request",this._requestHandler)},a.prototype.detachServer=function(){if(!this.server)throw new Error("Cannot detach from server: not attached.");this.server.removeListener("request",this._requestHandler),this.server=null},a.prototype.mount=function(e,t,s){if(!e)throw new Error("You must specify a path for this handler.");if(t||(t="____no_protocol____"),!s)throw new Error("You must specify a callback for this handler.");if(!((e=this.pathToRegExp(e))instanceof RegExp))throw new Error("Path must be specified as either a string or a RegExp.");var i=e.toString();if(t=t.toLocaleLowerCase(),-1!==this.findHandlerIndex(i,t))throw new Error("You may only mount one handler per path/protocol combination.");this.handlers.push({path:e,pathString:i,protocol:t,callback:s})},a.prototype.unmount=function(e,t){var s=this.findHandlerIndex(this.pathToRegExp(e).toString(),t);if(-1===s)throw new Error("Unable to find a route matching the specified path and protocol.");this.handlers.splice(s,1)},a.prototype.findHandlerIndex=function(e,t){t=t.toLocaleLowerCase();for(var s=0,i=this.handlers.length;s<i;s++){var n=this.handlers[s];if(n.pathString===e&&n.protocol===t)return s}return-1},a.prototype.pathToRegExp=function(e){return"string"==typeof e&&("*"===e?e=/^.*$/:(e=e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),e=new RegExp("^"+e+"$"))),e},a.prototype.handleRequest=function(e){var t=e.requestedProtocols;0===t.length&&(t=["____no_protocol____"]);for(var s=0;s<t.length;s++)for(var i=t[s].toLocaleLowerCase(),n=0,o=this.handlers.length;n<o;n++){var a=this.handlers[n];if(a.path.test(e.resourceURL.pathname)&&(i===a.protocol||"*"===a.protocol)){var c=new r(e,i);return void a.callback(c)}}e.reject(404,"No handler is available for the given request.")},e.exports=a},272:function(e,t,s){var i=s(39),n=s(78).EventEmitter;function o(e,t){n.call(this),this.webSocketRequest=e,this.protocol="____no_protocol____"===t?null:t,this.origin=e.origin,this.resource=e.resource,this.resourceURL=e.resourceURL,this.httpRequest=e.httpRequest,this.remoteAddress=e.remoteAddress,this.webSocketVersion=e.webSocketVersion,this.requestedExtensions=e.requestedExtensions,this.cookies=e.cookies}i.inherits(o,n),o.prototype.accept=function(e,t){var s=this.webSocketRequest.accept(this.protocol,e,t);return this.emit("requestAccepted",s),s},o.prototype.reject=function(e,t,s){this.webSocketRequest.reject(e,t,s),this.emit("requestRejected",this)},e.exports=o},273:function(e,t,s){var i=s(258),n=s(274),o=s(276);const r=0,a=1,c=2,h=3;function l(e,t,s,n,a,c){o.EventTarget.call(this),(c=c||{}).assembleFragments=!0;var h=this;this._url=e,this._readyState=r,this._protocol=void 0,this._extensions="",this._bufferedAmount=0,this._binaryType="arraybuffer",this._connection=void 0,this._client=new i(c),this._client.on("connect",(function(e){f.call(h,e)})),this._client.on("connectFailed",(function(){p.call(h)})),this._client.connect(e,t,s,n,a)}function u(e,t){var s=new o.Event("close");return s.code=e,s.reason=t,s.wasClean=void 0===e||1e3===e,s}function d(e){var t=new o.Event("message");return t.data=e,t}function f(e){var t=this;this._readyState=a,this._connection=e,this._protocol=e.protocol,this._extensions=e.extensions,this._connection.on("close",(function(e,s){m.call(t,e,s)})),this._connection.on("message",(function(e){b.call(t,e)})),this.dispatchEvent(new o.Event("open"))}function p(){g.call(this),this._readyState=h;try{this.dispatchEvent(new o.Event("error"))}finally{this.dispatchEvent(u(1006,"connection failed"))}}function m(e,t){g.call(this),this._readyState=h,this.dispatchEvent(u(e,t||""))}function b(e){if(e.utf8Data)this.dispatchEvent(d(e.utf8Data));else if(e.binaryData&&"arraybuffer"===this.binaryType){for(var t=e.binaryData,s=new ArrayBuffer(t.length),i=new Uint8Array(s),n=0,o=t.length;n<o;++n)i[n]=t[n];this.dispatchEvent(d(s))}}function g(){this._client.removeAllListeners(),this._connection&&this._connection.removeAllListeners()}e.exports=l,Object.defineProperties(l.prototype,{url:{get:function(){return this._url}},readyState:{get:function(){return this._readyState}},protocol:{get:function(){return this._protocol}},extensions:{get:function(){return this._extensions}},bufferedAmount:{get:function(){return this._bufferedAmount}}}),Object.defineProperties(l.prototype,{binaryType:{get:function(){return this._binaryType},set:function(e){if("arraybuffer"!==e)throw new SyntaxError('just "arraybuffer" type allowed for "binaryType" attribute');this._binaryType=e}}}),[["CONNECTING",r],["OPEN",a],["CLOSING",c],["CLOSED",h]].forEach((function(e){Object.defineProperty(l.prototype,e[0],{get:function(){return e[1]}})})),[["CONNECTING",r],["OPEN",a],["CLOSING",c],["CLOSED",h]].forEach((function(e){Object.defineProperty(l,e[0],{get:function(){return e[1]}})})),l.prototype.send=function(e){if(this._readyState!==a)throw new Error("cannot call send() while not connected");if("string"==typeof e||e instanceof String)this._connection.sendUTF(e);else if(e instanceof Buffer)this._connection.sendBytes(e);else{if(!e.byteLength&&0!==e.byteLength)throw new Error("unknown binary data:",e);e=n(e),this._connection.sendBytes(e)}},l.prototype.close=function(e,t){switch(this._readyState){case r:p.call(this),this._client.on("connect",(function(s){e?s.close(e,t):s.close()}));break;case a:this._readyState=c,e?this._connection.close(e,t):this._connection.close()}}},274:function(e,t,s){var i=s(275).strict;e.exports=function(e){if(i(e)){var t=Buffer.from(e.buffer);return e.byteLength!==e.buffer.byteLength&&(t=t.slice(e.byteOffset,e.byteOffset+e.byteLength)),t}return Buffer.from(e)}},275:function(e,t){e.exports=n,n.strict=o,n.loose=r;var s=Object.prototype.toString,i={"[object Int8Array]":!0,"[object Int16Array]":!0,"[object Int32Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Uint16Array]":!0,"[object Uint32Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0};function n(e){return o(e)||r(e)}function o(e){return e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array}function r(e){return i[s.call(e)]}},276:function(e,t,s){e.exports={EventTarget:s(277),Event:s(278)}},277:function(e,t){function s(){"function"!=typeof this.addEventListener&&(this._listeners={},this.addEventListener=i,this.removeEventListener=n,this.dispatchEvent=o)}function i(e,t){var s,i,n;if(e&&t){for(void 0===(s=this._listeners[e])&&(this._listeners[e]=s=[]),i=0;n=s[i];i++)if(n===t)return;s.push(t)}}function n(e,t){var s,i,n;if(e&&t&&void 0!==(s=this._listeners[e])){for(i=0;n=s[i];i++)if(n===t){s.splice(i,1);break}0===s.length&&delete this._listeners[e]}}function o(e){var t,s,i,n,o,r=!1;if(!e||"string"!=typeof e.type)throw new Error("`event` must have a valid `type` property");e._yaeti&&(e.target=this,e.cancelable=!0);try{e.stopImmediatePropagation=function(){r=!0}}catch(e){}for(t=e.type,s=this._listeners[t]||[],"function"==typeof(i=this["on"+t])&&i.call(this,e),n=0;(o=s[n])&&!r;n++)o.call(this,e);return!e.defaultPrevented}e.exports=s,Object.defineProperties(s.prototype,{listeners:{get:function(){return this._listeners}}})},278:function(e,t){e.exports=function(e){this.type=e,this.isTrusted=!1,this._yaeti=!0}},279:function(e,t){var s={disableWarnings:!1,deprecationWarningMap:{},warn:function(e){!this.disableWarnings&&this.deprecationWarningMap[e]&&(console.warn("DEPRECATION WARNING: "+this.deprecationWarningMap[e]),this.deprecationWarningMap[e]=!1)}};e.exports=s},280:function(e,t,s){e.exports=s(281).version},281:function(e){e.exports=JSON.parse('{"_from":"websocket@^1.0.34","_id":"websocket@1.0.34","_inBundle":false,"_integrity":"sha512-PRDso2sGwF6kM75QykIesBijKSVceR6jL2G8NGYyq2XrItNC2P5/qL5XeR056GhA+Ly7JMFvJb9I312mJfmqnQ==","_location":"/websocket","_phantomChildren":{},"_requested":{"type":"range","registry":true,"raw":"websocket@^1.0.34","name":"websocket","escapedName":"websocket","rawSpec":"^1.0.34","saveSpec":null,"fetchSpec":"^1.0.34"},"_requiredBy":["/alchemy-sdk"],"_resolved":"https://registry.npmjs.org/websocket/-/websocket-1.0.34.tgz","_shasum":"2bdc2602c08bf2c82253b730655c0ef7dcab3111","_spec":"websocket@^1.0.34","_where":"/Users/0xrom/Desktop/tokenIDAPI/node_modules/alchemy-sdk","author":{"name":"Brian McKelvey","email":"theturtle32@gmail.com","url":"https://github.com/theturtle32"},"browser":"lib/browser.js","bugs":{"url":"https://github.com/theturtle32/WebSocket-Node/issues"},"bundleDependencies":false,"config":{"verbose":false},"contributors":[{"name":"Iñaki Baz Castillo","email":"ibc@aliax.net","url":"http://dev.sipdoc.net"}],"dependencies":{"bufferutil":"^4.0.1","debug":"^2.2.0","es5-ext":"^0.10.50","typedarray-to-buffer":"^3.1.5","utf-8-validate":"^5.0.2","yaeti":"^0.0.6"},"deprecated":false,"description":"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.","devDependencies":{"buffer-equal":"^1.0.0","gulp":"^4.0.2","gulp-jshint":"^2.0.4","jshint":"^2.0.0","jshint-stylish":"^2.2.1","tape":"^4.9.1"},"directories":{"lib":"./lib"},"engines":{"node":">=4.0.0"},"homepage":"https://github.com/theturtle32/WebSocket-Node","keywords":["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],"license":"Apache-2.0","main":"index","name":"websocket","repository":{"type":"git","url":"git+https://github.com/theturtle32/WebSocket-Node.git"},"scripts":{"gulp":"gulp","test":"tape test/unit/*.js"},"version":"1.0.34"}')}};